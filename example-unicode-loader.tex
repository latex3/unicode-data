\begingroup
  \catcode`\{=1 %
  \catcode`\}=2 %
  \catcode`\#=6 %
  \def\C#1 #2 #3 {%
    \global\uccode"#1="#2 %
    \global\lccode"#1="#3 %
  }%
  \def\L#1 #2 #3 {%
    \global\catcode"#1=11 %
    \C#1 #2 #3 %
    \ifnum"#1="#3 %
    \else
      \global\sfcode"#1=999 %
    \fi
    \ifnum"#1<"10000 %
      \global\Umathcode"#1="7"01"#1 %
    \else
      \global\Umathcode"#1="0"01"#1 %
    \fi    
  }%
  \def\l#1 {\L#1 #1 #1 }%
  \let\m\l
  \input unicode-casing.def %
\endgroup
\ifdefined\XeTeXcharclass
\else
  \expandafter\endinput
\fi
\begingroup
  \def\setclass#1#2#3{%
    \ifnum#1>#2 %
      \expandafter\gobble
    \else
      \expandafter\firstofone
    \fi
      {%
        \global\XeTeXcharclass#1=#3 %
        \expandafter\setclass\expandafter
          {\number\numexpr#1+1\relax}{#2}{#3}%
      }%
  }%
  \def\gobble#1{}
  \def\firstofone#1{#1}
  \def\ID#1 #2 {\setclass{"#1}{"#2}{1}}
  \def\OP#1 {\setclass{"#1}{"#1}{2}}
  \def\CL#1 {\setclass{"#1}{"#1}{3}}
  \def\EX#1 {\setclass{"#1}{"#1}{3}}
  \def\IS#1 {\setclass{"#1}{"#1}{3}}
  \def\NS#1 {\setclass{"#1}{"#1}{3}}
  \def\CM#1 {\setclass{"#1}{"#1}{256}}
  \input unicode-classes.def %
\endgroup